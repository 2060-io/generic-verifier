# Setting up a development environment with docker

![2060 logo](https://raw.githubusercontent.com/2060-io/.github/44bf28569fec0251a9367a9f6911adfa18a01a7c/profile/assets/2060_logo.svg)

In this document, you will learn how to setup a development environment for working/modifying the verifier-app backend.
If you want to quickly deploy a clone or customize of one of the verifier app demos, you'd better jump to the [kubernetes howto]() documentation.

## Setup a SSL port forwarding service

For being able to test your service directly from your cellphone, you will need a port forwarding service.
In this example, we will use the ngrok service. The free version of ngrok is enough for what we need.

First, follow installation instructions on ngrok web site. Then edit your ngrok config file, add your authtoken and configure the tunnel section with the following:

```
authtoken: <your ngrok token>
tunnels:
    serviceagent:
        addr: 3001
        proto: http
        schemes:
            - https
    backend:
        addr: 2902
        proto: http
        schemes:
            - https
    verifier:
        addr: 2904
        proto: http
        schemes:
            - https
version: "2"
region: us
```

Then, start ngrok service:

```
$ ngrok start --all --config ngrok-config.yml
ngrok                                                                                                              (Ctrl+C to quit)

Build better APIs with ngrok. Early access: ngrok.com/early-access

Session Status                online
Account                       (Plan: Free)
Version                       3.5.0
Region                        United States (us)
Latency                       92ms
Web Interface                 http://127.0.0.1:4040
Forwarding                    https://04e8-190-24-98-158.ngrok-free.app -> http://localhost:2902
Forwarding                    https://11ee-190-24-98-158.ngrok-free.app -> http://localhost:2904
Forwarding                    https://59cd-190-24-98-158.ngrok-free.app -> http://localhost:3001
```

## Prepare docker-compose and start the containers

Before starting, replace the URLs according to the ports with the ones generated by Ngrok

```
version: "3"

services:
  verifier-app:
    # The verifier-app can function in standalone mode without 'depends_on' or 'SERVICE_AGENT_ADMIN_BASE_URL'.
    # By default, it points to the chatbot demo, making these dependencies optional.
    ports:
      - 2804:3000
    build: .
    command: yarn start
    environment:
      - NEXT_PUBLIC_PORT=3000
      - NEXT_PUBLIC_BASE_URL=https://p2804.ovpndev.2060.io
      # This environment variable is needed only when the verifier-app is used in conjunction with a service (not chatbot demo) and its service agent.
      # Otherwise, it defaults to the chatbot demo.
      - SERVICE_AGENT_ADMIN_BASE_URL=https://p2800.ovpndev.2060.io
    # 'depends_on' is only necessary when integrating with UnicId and its service agent for validation.
    # It is not required for standalone mode
    depends_on:
      - service-agent
      - unic-id-dts
    networks:
      - verifier

  # From this point onward, ensure that Ngrok is enabled for proper functionality and replace the URLs as specified in the documentation.
  service-agent:
    image: io2060/2060-service-agent:dev
    restart: always
    ports:
      - 2800:3000
      - 2801:3001
    environment:
      - AGENT_PUBLIC_DID=did:web:p2801.ovpndev.2060.io
      - AGENT_ENDPOINT=wss://p2801.ovpndev.2060.io
      - AGENT_INVITATION_IMAGE_URL=https://p2802.ovpndev.2060.io/avatar.png
      - AGENT_LABEL=Unic Id dts
      - ANONCREDS_SERVICE_BASE_URL=https://p2801.ovpndev.2060.io
      - PUBLIC_API_BASE_URL=https://p2801.ovpndev.2060.io
      - USE_CORS=true
      - EVENTS_BASE_URL=https://p2802.ovpndev.2060.io
      - POSTGRES_HOST=postgres
      - POSTGRES_USER=verifier
      - POSTGRES_PASSWORD=2060demo
    volumes:
      - ./afj:/root/.afj
    networks:
      - verifier

  unic-id-dts:
    image: io2060/unic.id-issuer-dts:dev
    container_name: unic-id-dts
    restart: always
    ports:
      - 2802:5000
    environment:
      - AGENT_PORT=5000
      - SERVICE_AGENT_ADMIN_URL=https://p2800.ovpndev.2060.io
      - POSTGRES_HOST=postgres
      - POSTGRES_USER=verifier
      - POSTGRES_PASSWORD=2060demo
      - VISION_URL=https://vision.dev.2060.io
      - WEBRTC_SERVER_URL=https://dts-webrtc.dev.2060.io
      - PUBLIC_BASE_URL=https://p2802.ovpndev.2060.io
      - ID_VERIFICATION_TIMEOUT_SECONDS=900
      - LOG_LEVEL=3
    networks:
      - verifier

  postgres:
    image: postgres:15.2
    restart: always
    ports:
      - 5432:5432
    environment:
      - POSTGRES_PASSWORD=2060demo
      - POSTGRES_USER=verifier
    networks:
      - verifier

networks:
  verifier:
    driver: bridge
```

Start the containers:

```
$ docker-compose up -d
```
verify containers are started:

```
$ docker ps
CONTAINER ID   IMAGE                                                 COMMAND                  CREATED         STATUS         PORTS                                                                                                               NAMES
8ed71159651b   io2060/2060-datastore:main                            "/usr/local/s2i/run"     3 seconds ago   Up 3 seconds   8080/tcp, 8443/tcp, 0.0.0.0:2904->2904/tcp, 8778/tcp                                                                docker-datastore-1
ee0e59f83606   apache/activemq-artemis                               "/docker-run.sh run"     3 seconds ago   Up 3 seconds   1883/tcp, 0.0.0.0:5672->5672/tcp, 5445/tcp, 9404/tcp, 0.0.0.0:8161->8161/tcp, 61613/tcp, 0.0.0.0:61616->61616/tcp   docker-artemis-1
100b146e717c   gitlab.mobiera.com:4567/2060/2060-service-agent:dev   "/bin/sh -c 'yarn st…"   3 seconds ago   Up 3 seconds   0.0.0.0:3000-3001->3000-3001/tcp                                                                                    docker-service-agent-1
12b7355f9b34   postgres:15.2                                         "docker-entrypoint.s…"   3 seconds ago   Up 3 seconds   0.0.0.0:5432->5432/tcp                                                                                              docker-postgres-1
```